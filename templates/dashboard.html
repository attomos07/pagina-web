<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Attomos</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/static/images/attomos-favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/images/attomos-favicon.png">
    
    <link href="https://cdn.lineicons.com/4.0/lineicons.css" rel="stylesheet" />
    <link rel="stylesheet" href="/static/css/dashboard.css">
</head>
<body>
    <!-- Decorative Rings -->
    <div class="decorative-rings">
        <div class="ring ring-1"></div>
        <div class="ring ring-2"></div>
        <div class="ring ring-3"></div>
        <div class="ring ring-4"></div>
    </div>

    <div class="app-container">
        <!-- Sidebar -->
        {{template "sidebar.html" .}}

        <!-- Main Content -->
        <div class="main-content">
            <!-- Userbar -->
            {{template "userbar.html" .}}

            <!-- Content Wrapper -->
            <div class="content-wrapper">
                <div class="dashboard-layout">
                    <!-- Create Button -->
                    <div class="page-header">
                        <a href="/onboarding" id="createAgentBtnDashboard" class="btn-primary">
                            <i class="lni lni-plus"></i>
                            <span>Crear Agente</span>
                        </a>
                    </div>

                    <!-- Stats -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon sky">
                                <svg class="stat-bot-icon" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <line x1="24" y1="6" x2="24" y2="10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <circle cx="24" cy="5" r="1.5" fill="currentColor"/>
                                    <rect x="14" y="10" width="20" height="16" rx="4" stroke="currentColor" stroke-width="2" fill="none"/>
                                    <circle cx="19" cy="16" r="2" fill="currentColor"/>
                                    <circle cx="29" cy="16" r="2" fill="currentColor"/>
                                    <path d="M 18 21 Q 24 23 30 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/>
                                    <rect x="16" y="26" width="16" height="12" rx="3" stroke="currentColor" stroke-width="2" fill="none"/>
                                    <circle cx="24" cy="31" r="2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                                    <circle cx="24" cy="31" r="0.8" fill="currentColor"/>
                                    <rect x="10" y="28" width="4" height="8" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                                    <rect x="34" y="28" width="4" height="8" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                                    <rect x="18" y="38" width="4" height="4" rx="1.5" stroke="currentColor" stroke-width="2" fill="none"/>
                                    <rect x="26" y="38" width="4" height="4" rx="1.5" stroke="currentColor" stroke-width="2" fill="none"/>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="activeAgentsCount">0</div>
                                <div class="stat-label">Agentes Activos</div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon fuchsia">
                                <i class="lni lni-comments"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">0</div>
                                <div class="stat-label">Conversaciones</div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon lime">
                                <i class="lni lni-calendar"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">0</div>
                                <div class="stat-label">Citas Agendadas</div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon amber">
                                <i class="lni lni-timer"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">--</div>
                                <div class="stat-label">Tiempo de Respuesta</div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Billing Section -->
                    <div class="ai-billing-section">
                        <div class="billing-header">
                            <div class="billing-title-wrapper">
                                <h2 class="section-title">
                                    <i class="lni lni-coin"></i>
                                    Costos de IA
                                </h2>
                                <span class="billing-badge">Gemini API</span>
                            </div>
                            <div class="billing-controls">
                                <div class="view-toggle-group" id="billingViewToggle">
                                    <button class="view-toggle-btn active" data-view="line" onclick="setBillingView('line')" title="Gr치fico de l칤nea">
                                        <i class="lni lni-graph"></i>
                                    </button>
                                    <button class="view-toggle-btn" data-view="bar" onclick="setBillingView('bar')" title="Gr치fico de barras">
                                        <i class="lni lni-bar-chart"></i>
                                    </button>
                                    <button class="view-toggle-btn" data-view="table" onclick="setBillingView('table')" title="Tabla">
                                        <i class="lni lni-list"></i>
                                    </button>
                                </div>
                                <select class="currency-select" id="currencySelect">
                                    <option value="MXN" selected>游쓇릖 MXN</option>
                                    <option value="USD">游쥟릖 USD</option>
                                    <option value="EUR">游쀯릖 EUR</option>
                                    <option value="GBP">游섫릖 GBP</option>
                                    <option value="CAD">游뻟릖 CAD</option>
                                    <option value="ARS">游뷣릖 ARS</option>
                                    <option value="COP">游뻟릖 COP</option>
                                    <option value="CLP">游뻟릖 CLP</option>
                                </select>
                                <select class="time-range-select" id="billingTimeRange">
                                    <option value="7">칔ltimos 7 d칤as</option>
                                    <option value="14">칔ltimos 14 d칤as</option>
                                    <option value="28" selected>칔ltimos 28 d칤as</option>
                                    <option value="90">칔ltimos 90 d칤as</option>
                                </select>
                            </div>
                        </div>

                        <div class="billing-card">
                            <div class="cost-summary">
                                <div class="cost-item">
                                    <div class="cost-label">Costo Total</div>
                                    <div class="cost-value" id="totalCost">$0.00</div>
                                </div>
                            </div>

                            <div class="chart-container" id="costChartContainer">
                                <canvas id="costChart"></canvas>
                            </div>

                            <div class="billing-table-container" id="costTableContainer" style="display:none;"></div>

                            <div class="billing-footer">
                                <div class="billing-info">
                                    <i class="lni lni-information"></i>
                                    <span>Los costos se actualizan cada hora. Basado en el uso de tokens de la API de Gemini.</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Unified Services Section -->
                    <div class="services-unified-section">
                        <div class="services-unified-header">
                            <h2 class="section-title">
                                <i class="lni lni-bar-chart"></i>
                                Estad칤sticas de Servicios
                            </h2>
                            <div class="export-buttons">
                                <button class="btn-export btn-export-excel" onclick="exportToExcel()">
                                    <i class="lni lni-download"></i>
                                    <span>Exportar Excel</span>
                                </button>
                                <button class="btn-export btn-export-pdf" onclick="exportToPDF()">
                                    <i class="lni lni-download"></i>
                                    <span>Exportar PDF</span>
                                </button>
                            </div>
                        </div>

                        <div class="services-unified-grid">

                            <!-- Most Requested Card -->
                            <div class="service-unified-card">
                                <div class="service-unified-card-header">
                                    <div class="service-card-title">
                                        <i class="lni lni-bar-chart"></i>
                                        <h3>Servicios M치s Pedidos</h3>
                                        <span class="pie-chart-badge" id="mostRequestedTotal">0 Total</span>
                                    </div>
                                    <div class="view-toggle-group">
                                        <button class="view-toggle-btn active" onclick="setUnifiedView('most', 'bars')" data-section="most" data-view="bars" title="Barras horizontales">
                                            <i class="lni lni-bar-chart"></i>
                                        </button>
                                        <button class="view-toggle-btn" onclick="setUnifiedView('most', 'pie')" data-section="most" data-view="pie" title="Gr치fico circular">
                                            <i class="lni lni-pie-chart"></i>
                                        </button>
                                        <button class="view-toggle-btn" onclick="setUnifiedView('most', 'table')" data-section="most" data-view="table" title="Tabla">
                                            <i class="lni lni-list"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Bars view -->
                                <div id="mostBarsView" class="service-view-panel">
                                    <div id="mostRequestedServicesContainer" class="service-bars-container"></div>
                                </div>

                                <!-- Pie view -->
                                <div id="mostPieView" class="service-view-panel" style="display:none;">
                                    <div class="pie-chart-content">
                                        <div class="pie-chart-canvas-wrapper">
                                            <canvas id="mostRequestedPieChart"></canvas>
                                        </div>
                                        <div class="pie-chart-legend" id="mostRequestedLegend"></div>
                                    </div>
                                </div>

                                <!-- Table view -->
                                <div id="mostTableView" class="service-view-panel" style="display:none;"></div>
                            </div>

                            <!-- Least Requested Card -->
                            <div class="service-unified-card least-requested">
                                <div class="service-unified-card-header">
                                    <div class="service-card-title">
                                        <i class="lni lni-stats-down"></i>
                                        <h3>Servicios Menos Pedidos</h3>
                                        <span class="pie-chart-badge" id="leastRequestedTotal">0 Total</span>
                                    </div>
                                    <div class="view-toggle-group">
                                        <button class="view-toggle-btn active" onclick="setUnifiedView('least', 'bars')" data-section="least" data-view="bars" title="Barras horizontales">
                                            <i class="lni lni-bar-chart"></i>
                                        </button>
                                        <button class="view-toggle-btn" onclick="setUnifiedView('least', 'pie')" data-section="least" data-view="pie" title="Gr치fico circular">
                                            <i class="lni lni-pie-chart"></i>
                                        </button>
                                        <button class="view-toggle-btn" onclick="setUnifiedView('least', 'table')" data-section="least" data-view="table" title="Tabla">
                                            <i class="lni lni-list"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Bars view -->
                                <div id="leastBarsView" class="service-view-panel">
                                    <div id="leastRequestedServicesContainer" class="service-bars-container"></div>
                                </div>

                                <!-- Pie view -->
                                <div id="leastPieView" class="service-view-panel" style="display:none;">
                                    <div class="pie-chart-content">
                                        <div class="pie-chart-canvas-wrapper">
                                            <canvas id="leastRequestedPieChart"></canvas>
                                        </div>
                                        <div class="pie-chart-legend" id="leastRequestedLegend"></div>
                                    </div>
                                </div>

                                <!-- Table view -->
                                <div id="leastTableView" class="service-view-panel" style="display:none;"></div>
                            </div>

                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- SheetJS para Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- jsPDF para PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="/static/js/sidebar.js"></script>
    <script src="/static/js/dashboard.js"></script>
</body>
</html>