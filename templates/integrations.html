<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integraciones - Attomos</title>
    <link href="https://cdn.lineicons.com/4.0/lineicons.css" rel="stylesheet" />
    <link rel="stylesheet" href="/static/css/integrations.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        {{template "sidebar.html" .}}

        <!-- Main Content -->
        <div class="main-content">
            <!-- Userbar -->
            {{template "userbar.html" .}}

            <!-- Content Wrapper -->
            <div class="content-wrapper">
                <div class="integrations-layout">
                    <!-- Page Header -->
                    <div class="page-header">
                        <div class="header-content">
                            <h1 class="page-title">
                                <i class="lni lni-plug"></i>
                                Integraciones
                            </h1>
                            <p class="page-subtitle">Conecta tus herramientas favoritas con Attomos</p>
                        </div>
                    </div>

                    <!-- Agent Selector -->
                    <div class="agent-selector">
                        <label class="selector-label">Selecciona un agente para configurar sus integraciones</label>
                        <div class="custom-select" id="agentSelect">
                            <div class="select-display" id="agentSelectDisplay">
                                Selecciona un agente...
                            </div>
                            <i class="lni lni-chevron-down select-arrow"></i>
                            <div class="select-dropdown" id="agentSelectDropdown">
                                <div class="select-options" id="agentSelectOptions">
                                    <!-- Agents will be loaded here dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Integrations Grid -->
                    <div class="integrations-grid" id="integrationsGrid">
                        <!-- Gemini API Key Card (Solo plan gratuito - AtomicBot) -->
                        <div class="integration-card" id="geminiCard" style="display: none;">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="lni lni-gemini integration-icon" style="font-size: 2rem; color: #8E44AD;"></i>
                                    <h2>Gemini AI</h2>
                                </div>
                                <div class="status-badge disconnected" id="geminiStatus">
                                    <span class="status-indicator"></span>
                                    No configurado
                                </div>
                            </div>

                            <p class="card-description">
                                Configura tu API Key de Google Gemini para potenciar tu agente con inteligencia artificial avanzada.
                            </p>

                            <div class="card-features">
                                <ul class="feature-list">
                                    <li class="feature-item">
                                        <i class="lni lni-brain"></i>
                                        IA conversacional avanzada
                                    </li>
                                    <li class="feature-item">
                                        <i class="lni lni-comments"></i>
                                        Respuestas naturales y contextuales
                                    </li>
                                    <li class="feature-item">
                                        <i class="lni lni-target-customer"></i>
                                        Personalización de personalidad
                                    </li>
                                    <li class="feature-item">
                                        <i class="lni lni-pulse"></i>
                                        Procesamiento en tiempo real
                                    </li>
                                </ul>
                            </div>

                            <div class="card-note">
                                <i class="lni lni-information"></i>
                                <span>Obtén tu API Key gratis en <a href="https://aistudio.google.com/apikey" target="_blank" style="color: #3b82f6; font-weight: 600; text-decoration: underline;">AI Studio de Google</a></span>
                            </div>

                            <!-- API Key Input Form -->
                            <div class="api-key-form" id="geminiApiKeyForm">
                                <div class="input-group">
                                    <label class="input-label" for="geminiApiKeyInput">
                                        <i class="lni lni-key"></i>
                                        API Key de Gemini
                                    </label>
                                    <div class="input-wrapper">
                                        <input 
                                            type="password" 
                                            id="geminiApiKeyInput" 
                                            class="api-key-input" 
                                            placeholder="AIzaSy..." 
                                            disabled
                                        />
                                        <button type="button" class="toggle-visibility" id="toggleGeminiKey" disabled>
                                            <i class="lni lni-eye"></i>
                                        </button>
                                    </div>
                                    <small class="input-hint">Tu API Key se encripta y almacena de forma segura</small>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="card-actions" id="geminiActions">
                                <button class="btn btn-connect" id="btnSaveGeminiKey" disabled>
                                    <i class="lni lni-save"></i>
                                    Guardar API Key
                                </button>
                            </div>

                            <!-- Manage Actions (hidden by default) -->
                            <div class="card-actions" id="geminiManageActions" style="display: none;">
                                <button class="btn btn-secondary" id="btnUpdateGeminiKey">
                                    <i class="lni lni-pencil"></i>
                                    Actualizar
                                </button>
                                <button class="btn btn-disconnect" id="btnRemoveGeminiKey">
                                    <i class="lni lni-trash"></i>
                                    Eliminar
                                </button>
                            </div>
                        </div>

                        <!-- Meta WhatsApp Business API Card (Solo planes de pago - OrbitalBot) -->
                        <div class="integration-card" id="metaCard" style="display: none;">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="lni lni-whatsapp integration-icon" style="font-size: 2rem; color: #25D366;"></i>
                                    <h2>Meta WhatsApp Business API</h2>
                                </div>
                                <div class="status-badge disconnected" id="metaStatus">
                                    <span class="status-indicator"></span>
                                    No configurado
                                </div>
                            </div>

                            <p class="card-description">
                                Configura las credenciales de Meta WhatsApp Business API para conectar tu agente con WhatsApp de manera oficial.
                            </p>

                            <div class="card-features">
                                <ul class="feature-list">
                                    <li class="feature-item">
                                        <i class="lni lni-shield-check"></i>
                                        API oficial de Meta
                                    </li>
                                    <li class="feature-item">
                                        <i class="lni lni-rocket"></i>
                                        Mayor estabilidad y velocidad
                                    </li>
                                    <li class="feature-item">
                                        <i class="lni lni-checkmark-circle"></i>
                                        Marca verificada de negocio
                                    </li>
                                    <li class="feature-item">
                                        <i class="lni lni-chart-up"></i>
                                        Sin límites de mensajes
                                    </li>
                                </ul>
                            </div>

                            <div class="card-note">
                                <i class="lni lni-information"></i>
                                <span>Obtén tus credenciales en <a href="https://developers.facebook.com/apps" target="_blank" style="color: #3b82f6; font-weight: 600; text-decoration: underline;">Meta for Developers</a></span>
                            </div>

                            <!-- Meta Credentials Form -->
                            <div class="api-key-form" id="metaCredentialsForm">
                                <div class="input-group" style="margin-bottom: 1rem;">
                                    <label class="input-label" for="metaPhoneNumberId">
                                        <i class="lni lni-phone"></i>
                                        Phone Number ID
                                    </label>
                                    <div class="input-wrapper">
                                        <input 
                                            type="text" 
                                            id="metaPhoneNumberId" 
                                            class="api-key-input" 
                                            placeholder="123456789012345" 
                                            disabled
                                        />
                                    </div>
                                    <small class="input-hint">ID del número de WhatsApp Business</small>
                                </div>

                                <div class="input-group" style="margin-bottom: 1rem;">
                                    <label class="input-label" for="metaAccessToken">
                                        <i class="lni lni-key"></i>
                                        Access Token (JWT)
                                    </label>
                                    <div class="input-wrapper">
                                        <input 
                                            type="password" 
                                            id="metaAccessToken" 
                                            class="api-key-input" 
                                            placeholder="EAAxxxxxxxxxxxxx..." 
                                            disabled
                                        />
                                        <button type="button" class="toggle-visibility" id="toggleMetaToken" disabled>
                                            <i class="lni lni-eye"></i>
                                        </button>
                                    </div>
                                    <small class="input-hint">Token de acceso de larga duración</small>
                                </div>

                                <div class="input-group" style="margin-bottom: 1rem;">
                                    <label class="input-label" for="metaWabaId">
                                        <i class="lni lni-briefcase"></i>
                                        WABA ID
                                    </label>
                                    <div class="input-wrapper">
                                        <input 
                                            type="text" 
                                            id="metaWabaId" 
                                            class="api-key-input" 
                                            placeholder="123456789012345" 
                                            disabled
                                        />
                                    </div>
                                    <small class="input-hint">WhatsApp Business Account ID</small>
                                </div>

<div class="input-group">
                                    <label class="input-label" for="metaVerifyToken">
                                        <i class="lni lni-lock"></i>
                                        Verify Token
                                    </label>
                                    <div class="input-wrapper">
                                        <input 
                                            type="password" 
                                            id="metaVerifyToken" 
                                            class="api-key-input" 
                                            placeholder="mi_token_secreto_123" 
                                            disabled
                                        />
                                        <button type="button" class="toggle-visibility" id="toggleMetaVerify" disabled>
                                            <i class="lni lni-eye"></i>
                                        </button>
                                    </div>
                                    <small class="input-hint">Token para verificar webhook (puedes elegir cualquier texto)</small>
                                </div>
                            </div>

                            <!-- Webhook URL Info -->
                            <div class="card-note" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%); border-left: 3px solid #10b981;">
                                <i class="lni lni-link" style="color: #10b981;"></i>
                                <div style="flex: 1;">
                                    <span style="color: #065f46; font-weight: 600; display: block; margin-bottom: 0.5rem;">URL de devolución de llamada (Webhook URL)</span>
                                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                        <code id="webhookUrl" style="flex: 1; background: white; padding: 0.5rem 0.75rem; border-radius: 6px; font-size: 0.85rem; color: #1a1a1a; border: 1px solid #d1d5db; font-family: 'Courier New', monospace;">-</code>
                                        <button type="button" class="btn-copy-webhook" id="btnCopyWebhook" style="background: #10b981; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.875rem; font-weight: 600; display: none; align-items: center; gap: 0.375rem; transition: all 0.3s ease;">
                                            <i class="lni lni-copy"></i>
                                            Copiar
                                        </button>
                                    </div>
                                    <span style="color: #065f46; font-size: 0.8rem; display: block;">Copia esta URL y agrégala en la configuración de Webhook de Meta. Asegúrate de usar HTTPS.</span>
                                </div>
                            </div>

                            <!-- Connection Info (hidden by default) -->
                            <div class="connection-info" id="metaConnectionInfo" style="display: none;">
                                <div class="connection-details">
                                    <div class="connection-detail">
                                        <span class="connection-label">Número:</span>
                                        <span class="connection-value" id="metaDisplayNumber">-</span>
                                    </div>
                                    <div class="connection-detail">
                                        <span class="connection-label">Nombre verificado:</span>
                                        <span class="connection-value" id="metaVerifiedName">-</span>
                                    </div>
                                    <div class="connection-detail">
                                        <span class="connection-label">Conectado:</span>
                                        <span class="connection-value" id="metaConnectedAt">-</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="card-actions" id="metaActions">
                                <button class="btn btn-connect" id="btnSaveMetaCredentials" disabled>
                                    <i class="lni lni-save"></i>
                                    Guardar Credenciales
                                </button>
                            </div>

                            <!-- Manage Actions (hidden by default) -->
                            <div class="card-actions" id="metaManageActions" style="display: none;">
                                <button class="btn btn-secondary" id="btnUpdateMetaCredentials">
                                    <i class="lni lni-pencil"></i>
                                    Actualizar
                                </button>
                                <button class="btn btn-disconnect" id="btnRemoveMetaCredentials">
                                    <i class="lni lni-trash"></i>
                                    Eliminar
                                </button>
                            </div>
                        </div>

                        <!-- Google Calendar Card -->
                        <div class="integration-card" id="googleCalendarCard">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="lni lni-calendar-days integration-icon" style="font-size: 2rem; color: #4285F4;"></i>
                                    <h2>Google Calendar</h2>
                                </div>
                                <div class="status-badge disconnected" id="googleStatus">
                                    <span class="status-indicator"></span>
                                    No conectado
                                </div>
                            </div>

                            <p class="card-description">
                                Sincroniza citas automáticamente con Google Calendar. Tu agente podrá consultar disponibilidad y crear eventos.
                            </p>

                            <div class="card-features">
                                <ul class="feature-list">
                                    <li class="feature-item">
                                        <i class="lni lni-calendar"></i>
                                        Crear citas automáticamente
                                    </li>
                                    <li class="feature-item">
                                        <i class="lni lni-checkmark-circle"></i>
                                        Consultar disponibilidad en tiempo real
                                    </li>
                                    <li class="feature-item">
                                        <i class="lni lni-timer"></i>
                                        Recordatorios automáticos
                                    </li>
                                    <li class="feature-item">
                                        <i class="lni lni-sync"></i>
                                        Sincronización bidireccional
                                    </li>
                                </ul>
                            </div>

                            <!-- Connection Info (hidden by default) -->
                            <div class="connection-info" id="googleConnectionInfo" style="display: none;">
                                <div class="connection-details">
                                    <div class="connection-detail">
                                        <span class="connection-label">Email:</span>
                                        <span class="connection-value" id="calendarEmail">-</span>
                                    </div>
                                    <div class="connection-detail">
                                        <span class="connection-label">Conectado:</span>
                                        <span class="connection-value" id="connectedAt">-</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="card-actions" id="googleActions">
                                <button class="btn btn-connect" id="btnConnectGoogle" disabled>
                                    <i class="lni lni-link"></i>
                                    Conectar Calendar
                                </button>
                            </div>

                            <!-- Disconnect/Reconnect Buttons (hidden by default) -->
                            <div class="card-actions" id="googleManageActions" style="display: none;">
                                <button class="btn btn-secondary" id="btnReconnectGoogle">
                                    <i class="lni lni-reload"></i>
                                    Reconectar
                                </button>
                                <button class="btn btn-disconnect" id="btnDisconnectGoogle">
                                    <i class="lni lni-unlink"></i>
                                    Desconectar
                                </button>
                            </div>
                        </div>

                        <!-- Google Sheets Card -->
                        <div class="integration-card" id="googleSheetsCard">
                            <div class="card-header">
                                <div class="card-title">
                                    <svg class="integration-icon" style="width: 32px; height: 32px; color: #0F9D58;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect width="18" height="18" x="3" y="3" rx="2" ry="2"/>
                                        <line x1="3" x2="21" y1="9" y2="9"/>
                                        <line x1="3" x2="21" y1="15" y2="15"/>
                                        <line x1="9" x2="9" y1="9" y2="21"/>
                                        <line x1="15" x2="15" y1="9" y2="21"/>
                                    </svg>
                                    <h2>Google Sheets</h2>
                                </div>
                                <div class="status-badge disconnected" id="googleSheetsStatus">
                                    <span class="status-indicator"></span>
                                    No conectado
                                </div>
                            </div>

                            <p class="card-description">
                                Registra todas las citas automáticamente en una hoja de cálculo para llevar un control detallado de tus reservas.
                            </p>

                            <div class="card-features">
                                <ul class="feature-list">
                                    <li class="feature-item">
                                        <i class="lni lni-write"></i>
                                        Registro automático de citas
                                    </li>
                                    <li class="feature-item">
                                        <i class="lni lni-pie-chart"></i>
                                        Análisis y estadísticas
                                    </li>
                                    <li class="feature-item">
                                        <i class="lni lni-download"></i>
                                        Exportación de datos
                                    </li>
                                    <li class="feature-item">
                                        <i class="lni lni-users"></i>
                                        Acceso compartido al equipo
                                    </li>
                                </ul>
                            </div>

                            <!-- Connection Info (hidden by default) -->
                            <div class="connection-info" id="googleSheetsConnectionInfo" style="display: none;">
                                <div class="connection-details">
                                    <div class="connection-detail">
                                        <span class="connection-label">Sheet:</span>
                                        <a href="#" id="sheetLink" class="connection-link" target="_blank">
                                            Ver hoja de citas
                                            <i class="lni lni-arrow-right"></i>
                                        </a>
                                    </div>
                                    <div class="connection-detail">
                                        <span class="connection-label">Conectado:</span>
                                        <span class="connection-value" id="sheetsConnectedAt">-</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Note: Uses same Google connection -->
                            <div class="card-note">
                                <i class="lni lni-information"></i>
                                <span>Google Sheets se conecta automáticamente cuando conectas Google Calendar</span>
                            </div>
                        </div>

                        <!-- Placeholder for future integrations -->
                        <div class="integration-card coming-soon">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="lni lni-more" style="font-size: 2rem; color: #6b7280;"></i>
                                    <h2>Más integraciones próximamente</h2>
                                </div>
                                <div class="status-badge" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white;">
                                    <span class="status-indicator"></span>
                                    Próximamente
                                </div>
                            </div>

                            <p class="card-description">
                                Estamos trabajando en nuevas integraciones para mejorar tu experiencia. ¿Qué herramienta te gustaría integrar?
                            </p>

                            <div class="card-features">
                                <ul class="feature-list">
                                    <li class="feature-item">
                                        <i class="lni lni-slack"></i>
                                        Slack
                                    </li>
                                    <li class="feature-item">
                                        <i class="lni lni-stripe"></i>
                                        Stripe Payments
                                    </li>
                                    <li class="feature-item">
                                        <i class="lni lni-shopify"></i>
                                        Shopify
                                    </li>
                                    <li class="feature-item">
                                        <i class="lni lni-cloud"></i>
                                        Y muchas más...
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- No Agent Selected State -->
                    <div class="empty-state" id="emptyState">
                        <i class="lni lni-inbox"></i>
                        <h3>Selecciona un agente</h3>
                        <p>Selecciona un agente del menú superior para ver y configurar sus integraciones</p>
                    </div>

                    <!-- No Agents State -->
                    <div class="empty-state" id="noAgentsState" style="display: none;">
                        <i class="lni lni-robot"></i>
                        <h3>No tienes agentes</h3>
                        <p>Crea tu primer agente para comenzar a usar las integraciones</p>
                        <a href="/onboarding" class="btn btn-connect" style="margin-top: 1.5rem;">
                            <i class="lni lni-plus"></i>
                            Crear Agente
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/sidebar.js"></script>
    <script src="/static/js/integrations.js"></script>
</body>
</html>